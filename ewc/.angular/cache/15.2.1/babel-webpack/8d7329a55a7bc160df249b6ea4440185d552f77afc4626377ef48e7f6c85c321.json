{"ast":null,"code":"\"use strict\";\n\nvar _a;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PropertyExtractor = exports.uniqueArray = exports.REMOVED_MODULES = exports.reflectionCapabilities = void 0;\nconst common_1 = require(\"@angular/common\");\nconst core_1 = require(\"@angular/core\");\nconst platform_browser_1 = require(\"@angular/platform-browser\");\nconst animations_1 = require(\"@angular/platform-browser/animations\");\nconst NgModulesAnalyzer_1 = require(\"./NgModulesAnalyzer\");\nexports.reflectionCapabilities = new core_1.ɵReflectionCapabilities();\nexports.REMOVED_MODULES = new core_1.InjectionToken('REMOVED_MODULES');\nconst uniqueArray = arr => {\n  return arr.flat(Number.MAX_VALUE).filter(Boolean).filter((value, index, self) => self.indexOf(value) === index);\n};\nexports.uniqueArray = uniqueArray;\nclass PropertyExtractor {\n  /* eslint-enable @typescript-eslint/lines-between-class-members */\n  constructor(metadata, component) {\n    this.metadata = metadata;\n    this.component = component;\n    /* eslint-disable @typescript-eslint/lines-between-class-members */\n    this.declarations = [];\n    /**\n     * Analyze NgModule Metadata\n     *\n     * - Removes Restricted Imports\n     * - Extracts providers from ModuleWithProviders\n     * - Flattens imports\n     * - Returns a new NgModuleMetadata object\n     *\n     *\n     */\n    this.analyzeMetadata = metadata => {\n      const declarations = [...(metadata?.declarations || [])];\n      const providers = [...(metadata?.providers || [])];\n      const singletons = [...(metadata?.singletons || [])];\n      const imports = [...(metadata?.imports || [])].reduce((acc, imported) => {\n        // remove ngModule and use only its providers if it is restricted\n        // (e.g. BrowserModule, BrowserAnimationsModule, NoopAnimationsModule, ...etc)\n        const [isRestricted, restrictedProviders] = PropertyExtractor.analyzeRestricted(imported);\n        if (isRestricted) {\n          singletons.unshift(restrictedProviders || []);\n          return acc;\n        }\n        acc.push(imported);\n        return acc;\n      }, []);\n      return {\n        ...metadata,\n        imports,\n        providers,\n        singletons,\n        declarations\n      };\n    };\n    this.init();\n  }\n  init() {\n    const analyzed = this.analyzeMetadata(this.metadata);\n    this.imports = (0, exports.uniqueArray)([common_1.CommonModule, analyzed.imports]);\n    this.providers = (0, exports.uniqueArray)(analyzed.providers);\n    this.singletons = (0, exports.uniqueArray)(analyzed.singletons);\n    this.declarations = (0, exports.uniqueArray)(analyzed.declarations);\n    if (this.component) {\n      const {\n        isDeclarable,\n        isStandalone\n      } = PropertyExtractor.analyzeDecorators(this.component);\n      const isDeclared = (0, NgModulesAnalyzer_1.isComponentAlreadyDeclared)(this.component, analyzed.declarations, this.imports);\n      if (isStandalone) {\n        this.imports.push(this.component);\n      } else if (isDeclarable && !isDeclared) {\n        this.declarations.push(this.component);\n      }\n    }\n  }\n}\nexports.PropertyExtractor = PropertyExtractor;\n_a = PropertyExtractor;\nPropertyExtractor.analyzeRestricted = ngModule => {\n  /**\n   * BrowserModule is restricted,\n   * because bootstrapApplication API, which mounts the component to the DOM,\n   * automatically imports BrowserModule\n   */\n  if (ngModule === platform_browser_1.BrowserModule) {\n    return [true];\n  }\n  /**\n   * BrowserAnimationsModule imports BrowserModule, which is restricted,\n   * because bootstrapApplication API, which mounts the component to the DOM,\n   * automatically imports BrowserModule\n   */\n  if (ngModule === animations_1.BrowserAnimationsModule) {\n    return [true, (0, animations_1.provideAnimations)()];\n  }\n  /**\n   * NoopAnimationsModule imports BrowserModule, which is restricted,\n   * because bootstrapApplication API, which mounts the component to the DOM,\n   * automatically imports BrowserModule\n   */\n  if (ngModule === animations_1.NoopAnimationsModule) {\n    return [true, (0, animations_1.provideNoopAnimations)()];\n  }\n  return [false];\n};\nPropertyExtractor.analyzeDecorators = component => {\n  const decorators = exports.reflectionCapabilities.annotations(component);\n  const isComponent = decorators.some(d => _a.isDecoratorInstanceOf(d, 'Component'));\n  const isDirective = decorators.some(d => _a.isDecoratorInstanceOf(d, 'Directive'));\n  const isPipe = decorators.some(d => _a.isDecoratorInstanceOf(d, 'Pipe'));\n  const isDeclarable = isComponent || isDirective || isPipe;\n  const isStandalone = isComponent && decorators.some(d => d.standalone);\n  return {\n    isDeclarable,\n    isStandalone\n  };\n};\nPropertyExtractor.isDecoratorInstanceOf = (decorator, name) => {\n  let factory;\n  switch (name) {\n    case 'Component':\n      factory = core_1.Component;\n      break;\n    case 'Directive':\n      factory = core_1.Directive;\n      break;\n    case 'Pipe':\n      factory = core_1.Pipe;\n      break;\n    case 'Injectable':\n      factory = core_1.Injectable;\n      break;\n    case 'Input':\n      factory = core_1.Input;\n      break;\n    case 'Output':\n      factory = core_1.Output;\n      break;\n    default:\n      throw new Error(`Unknown decorator type: ${name}`);\n  }\n  return decorator instanceof factory || decorator.ngMetadataName === name;\n};","map":{"version":3,"names":["_a","Object","defineProperty","exports","value","PropertyExtractor","uniqueArray","REMOVED_MODULES","reflectionCapabilities","common_1","require","core_1","platform_browser_1","animations_1","NgModulesAnalyzer_1","ɵReflectionCapabilities","InjectionToken","arr","flat","Number","MAX_VALUE","filter","Boolean","index","self","indexOf","constructor","metadata","component","declarations","analyzeMetadata","providers","singletons","imports","reduce","acc","imported","isRestricted","restrictedProviders","analyzeRestricted","unshift","push","init","analyzed","CommonModule","isDeclarable","isStandalone","analyzeDecorators","isDeclared","isComponentAlreadyDeclared","ngModule","BrowserModule","BrowserAnimationsModule","provideAnimations","NoopAnimationsModule","provideNoopAnimations","decorators","annotations","isComponent","some","d","isDecoratorInstanceOf","isDirective","isPipe","standalone","decorator","name","factory","Component","Directive","Pipe","Injectable","Input","Output","Error","ngMetadataName"],"sources":["/Users/gabriele/Training/microfrontend/ewc/node_modules/@storybook/angular/dist/client/angular-beta/utils/PropertyExtractor.js"],"sourcesContent":["\"use strict\";\nvar _a;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PropertyExtractor = exports.uniqueArray = exports.REMOVED_MODULES = exports.reflectionCapabilities = void 0;\nconst common_1 = require(\"@angular/common\");\nconst core_1 = require(\"@angular/core\");\nconst platform_browser_1 = require(\"@angular/platform-browser\");\nconst animations_1 = require(\"@angular/platform-browser/animations\");\nconst NgModulesAnalyzer_1 = require(\"./NgModulesAnalyzer\");\nexports.reflectionCapabilities = new core_1.ɵReflectionCapabilities();\nexports.REMOVED_MODULES = new core_1.InjectionToken('REMOVED_MODULES');\nconst uniqueArray = (arr) => {\n    return arr\n        .flat(Number.MAX_VALUE)\n        .filter(Boolean)\n        .filter((value, index, self) => self.indexOf(value) === index);\n};\nexports.uniqueArray = uniqueArray;\nclass PropertyExtractor {\n    /* eslint-enable @typescript-eslint/lines-between-class-members */\n    constructor(metadata, component) {\n        this.metadata = metadata;\n        this.component = component;\n        /* eslint-disable @typescript-eslint/lines-between-class-members */\n        this.declarations = [];\n        /**\n         * Analyze NgModule Metadata\n         *\n         * - Removes Restricted Imports\n         * - Extracts providers from ModuleWithProviders\n         * - Flattens imports\n         * - Returns a new NgModuleMetadata object\n         *\n         *\n         */\n        this.analyzeMetadata = (metadata) => {\n            const declarations = [...(metadata?.declarations || [])];\n            const providers = [...(metadata?.providers || [])];\n            const singletons = [...(metadata?.singletons || [])];\n            const imports = [...(metadata?.imports || [])].reduce((acc, imported) => {\n                // remove ngModule and use only its providers if it is restricted\n                // (e.g. BrowserModule, BrowserAnimationsModule, NoopAnimationsModule, ...etc)\n                const [isRestricted, restrictedProviders] = PropertyExtractor.analyzeRestricted(imported);\n                if (isRestricted) {\n                    singletons.unshift(restrictedProviders || []);\n                    return acc;\n                }\n                acc.push(imported);\n                return acc;\n            }, []);\n            return { ...metadata, imports, providers, singletons, declarations };\n        };\n        this.init();\n    }\n    init() {\n        const analyzed = this.analyzeMetadata(this.metadata);\n        this.imports = (0, exports.uniqueArray)([common_1.CommonModule, analyzed.imports]);\n        this.providers = (0, exports.uniqueArray)(analyzed.providers);\n        this.singletons = (0, exports.uniqueArray)(analyzed.singletons);\n        this.declarations = (0, exports.uniqueArray)(analyzed.declarations);\n        if (this.component) {\n            const { isDeclarable, isStandalone } = PropertyExtractor.analyzeDecorators(this.component);\n            const isDeclared = (0, NgModulesAnalyzer_1.isComponentAlreadyDeclared)(this.component, analyzed.declarations, this.imports);\n            if (isStandalone) {\n                this.imports.push(this.component);\n            }\n            else if (isDeclarable && !isDeclared) {\n                this.declarations.push(this.component);\n            }\n        }\n    }\n}\nexports.PropertyExtractor = PropertyExtractor;\n_a = PropertyExtractor;\nPropertyExtractor.analyzeRestricted = (ngModule) => {\n    /**\n     * BrowserModule is restricted,\n     * because bootstrapApplication API, which mounts the component to the DOM,\n     * automatically imports BrowserModule\n     */\n    if (ngModule === platform_browser_1.BrowserModule) {\n        return [true];\n    }\n    /**\n     * BrowserAnimationsModule imports BrowserModule, which is restricted,\n     * because bootstrapApplication API, which mounts the component to the DOM,\n     * automatically imports BrowserModule\n     */\n    if (ngModule === animations_1.BrowserAnimationsModule) {\n        return [true, (0, animations_1.provideAnimations)()];\n    }\n    /**\n     * NoopAnimationsModule imports BrowserModule, which is restricted,\n     * because bootstrapApplication API, which mounts the component to the DOM,\n     * automatically imports BrowserModule\n     */\n    if (ngModule === animations_1.NoopAnimationsModule) {\n        return [true, (0, animations_1.provideNoopAnimations)()];\n    }\n    return [false];\n};\nPropertyExtractor.analyzeDecorators = (component) => {\n    const decorators = exports.reflectionCapabilities.annotations(component);\n    const isComponent = decorators.some((d) => _a.isDecoratorInstanceOf(d, 'Component'));\n    const isDirective = decorators.some((d) => _a.isDecoratorInstanceOf(d, 'Directive'));\n    const isPipe = decorators.some((d) => _a.isDecoratorInstanceOf(d, 'Pipe'));\n    const isDeclarable = isComponent || isDirective || isPipe;\n    const isStandalone = isComponent && decorators.some((d) => d.standalone);\n    return { isDeclarable, isStandalone };\n};\nPropertyExtractor.isDecoratorInstanceOf = (decorator, name) => {\n    let factory;\n    switch (name) {\n        case 'Component':\n            factory = core_1.Component;\n            break;\n        case 'Directive':\n            factory = core_1.Directive;\n            break;\n        case 'Pipe':\n            factory = core_1.Pipe;\n            break;\n        case 'Injectable':\n            factory = core_1.Injectable;\n            break;\n        case 'Input':\n            factory = core_1.Input;\n            break;\n        case 'Output':\n            factory = core_1.Output;\n            break;\n        default:\n            throw new Error(`Unknown decorator type: ${name}`);\n    }\n    return decorator instanceof factory || decorator.ngMetadataName === name;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}